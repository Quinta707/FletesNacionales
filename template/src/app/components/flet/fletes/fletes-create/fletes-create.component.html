<div class="container">
  <app-breadcrumb [title]="'Fletes crear'" [items]="['Flet']" [active_item]="'Fletes'"></app-breadcrumb>
  <br>
  <div class="row">
    <div class="col-12">
        <div class="card">
          <div class="card-header">
            <h5>Flete</h5>
          </div>
          <div class="card-body">
            <aw-wizard navBarLayout="large-filled-symbols">
              <aw-wizard-step>
                <form [formGroup]="firstFormGroup">
                  <ng-template awWizardStepSymbol>
                    <div class="f1-step">
                      <div class="f1-step-icon"><i class="fa fa-truck" style="transform: scaleX(-1)"></i></div>
                      <p>Flete</p>
                    </div>
                  </ng-template>
                  <div class="row mt-4">
                    <div class="col">
                      <div class="col-form-label">Vehiculo</div>
                    <ng-select [items]="vehiculosDdl" class="" formControlName="vehi_Id"
                    [(ngModel)]="datosFelte.vehi_Id" groupBy="job" placeholder="Vehiculo" ></ng-select>
                    <ng-container class="invalid text-danger"
                      *ngIf="firstFormGroup.get('vehi_Id').hasError('required') && firstFormGroup.get('vehi_Id').touched">
                      <p class="text-danger">El vehiculo es necesario</p></ng-container>
                    </div>
                    <div class="col">
                      <div class="col-form-label">Empleado</div>
                    <ng-select [items]="empleadosDdl" class="" formControlName="empe_Id"
                    [(ngModel)]="datosFelte.empe_Id" groupBy="job" placeholder="Empleado"></ng-select>
                    <ng-container class="invalid text-danger"
                      *ngIf="firstFormGroup.get('empe_Id').hasError('required') && firstFormGroup.get('empe_Id').touched">
                      <p class="text-danger">El empleado es necesario</p></ng-container>
                    </div>
                  </div>
                  <div class="row mt-2">
                    <div class="col">
                      <div class="col-form-label">Desde</div>
                      <ng-select [items]="municipiosDdl" class="" formControlName="muni_Inicio"
                      [(ngModel)]="datosTrayecto.muni_Inicio" bindValue="value" groupBy="job" placeholder="Municipio de salida"></ng-select>
                      <ng-container class="invalid text-danger"
                      *ngIf="firstFormGroup.get('muni_Inicio').hasError('required') && firstFormGroup.get('muni_Inicio').touched">
                      <p class="text-danger">El municipio de salida es necesario</p></ng-container>
                    </div>
                    <div class="col">
                      <div class="col-form-label">Hasta</div>
                      <ng-select [items]="municipiosDdl" class="" formControlName="muni_Final"
                      [(ngModel)]="datosTrayecto.muni_Final" bindValue="value" groupBy="job" placeholder="Municipio de destino"></ng-select>
                      <ng-container class="invalid text-danger"
                      *ngIf="firstFormGroup.get('muni_Final').hasError('required') && firstFormGroup.get('muni_Final').touched">
                      <p class="text-danger">El municipio de destino es necesario</p></ng-container>
                    </div>
                  </div>
                  <div class="row mt-2">
                    <div class="col-6" >
                      <div class="col-form-label">Fecha de salida</div>
                      <input  class="datepicker-here form-control digits text-dark"
                              formControlName="flet_FechaDeSalida"
                              [(ngModel)]="datosFelte.flet_FechaDeSalida"
                              placeholder="yyyy-mm-dd"
                              name="dp"
                              ngbDatepicker
                              #d="ngbDatepicker"
                              (click)="d.toggle()"
                              [minDate]="getToday()">

                      <ng-container class="invalid text-danger"
                      *ngIf="firstFormGroup.get('flet_FechaDeSalida').hasError('required') && firstFormGroup.get('flet_FechaDeSalida').touched">
                      <p class="text-danger">La fecha de salida es necesaria</p></ng-container>
                    </div>
                  </div>
                  <button class="btn btn-primary pull-right mt-3" type="submit" awNextStep (click)="seleccionarPedidos(content1)"
                    [disabled]="!firstFormGroup.valid">Siguiente</button>
                </form> 
              </aw-wizard-step>
              <aw-wizard-step>
                <form [formGroup]="secondFormGroup">
                  <ng-template awWizardStepSymbol>
                    <div class="f1-step">
                      <div class="f1-step-icon"><i class="icofont icofont-box"></i></div>
                      <p>Pedido</p>
                    </div>
                  </ng-template>

                  <div *ngIf="pedidos.length === 0" class="mt-3">
                    <div class="text-center mt-3">
                      <h4 class="text-muted">No tienes pedidos pendientes</h4>
                      <img src="https://i.ibb.co/D56drx0/11669662-20943860.jpg" alt="No tienes pedidos pendientes" width="200" height="200">
                    </div>
                  </div>


                  <div *ngIf="pedidos.length > 0" class="card-body megaoptions-border-space-sm">
                    <div class="row d-flex justify-content-end">
                      <div class="col d-flex justify-content-end">
                        <table> 
                          <tbody>
                            <tr [class.text-danger]="pesoMax < pesoUso">
                              <td><h6>Peso: {{pesoUso}}/{{pesoMax}}</h6></td>
                            </tr>
                            <tr [class.text-danger]="voluMax < voluUso">
                              <td><h6>Volumen: {{voluUso}}/{{voluMax}}</h6> </td>
                            </tr>
                          </tbody>
                        </table>
                        
                        
                      </div>
                    </div>
                    <div class="mega-inline row">
                        <div class="col-6" *ngFor="let item of pedidos">
                          <div class="card">
                            <div class="media p-20">
                              <div class="form-check checkbox checkbox-primary me-3">
                                <input class="form-check-input" [id]="item.pedi_Id" type="checkbox" (change)="toggleSelection(item)"/>
                                <label class="form-check-label" [for]="item.pedi_Id"></label>
                              </div>
                              <div class="media-body">
                                <h6 class="mt-0 mega-title-badge">Pedido de: {{ item.clie_NombreCompleto }}<span class="badge badge-primary pull-right digits">{{ item.pedi_Id }}</span></h6>
                                <p>Ciudad de destino: {{ item.pedi_DepaDestino }}
                                  <br>Peso de: {{item.pedi_Peso}} Kg
                                  <br>Volumen de: {{item.pedi_Volumen}} mtª</p>
                              </div>
                            </div>
                          </div>
                        </div>
                        
                    </div>
                     <div class="text-center mt-2">
                   <ng-container
                    *ngIf="secondFormGroup.get('pedidosArray').hasError('required')">
                        <h5 class="text-danger">Seleccione al menos un pedido</h5></ng-container>
                  </div>
                  </div>
                 
                  
                  <button class="btn btn-primary pull-right" (click)="guardar()" type="button" awNextStep
                    [disabled]="!secondFormGroup.valid || pesoMax < pesoUso || voluMax < voluUso">Listo</button>
                  <button class="btn btn-secondary pull-right me-1" type="button" awPreviousStep>Anterior</button>
                </form>
              </aw-wizard-step>
              <aw-wizard-completion-step awEnableBackLinks>
                <ng-template awWizardStepSymbol>
                    <div class="f1-step">
                      <div class="f1-step-icon"><i class="icofont icofont-truck-loaded"></i></div>
                      <p>Listo</p>
                    </div>
                  </ng-template>
                <div class="px-4">
                  <div class="row mt-4">
                    <div class="col-sm-4" style="border-right: 2px solid black;">
                      <img src="https://i.ibb.co/D56drx0/11669662-20943860.jpg" alt="No tienes pedidos pendientes" width="100%">
                  </div>
                  <div class="col-sm-8">
                    <div class="row mt-4 d-flex justify-content-between">
                      <div class="col">
                        <h3>Flete</h3>
                      </div>
                      <div class="col text-end">
                        <h3>Nº 28</h3>
                      </div>
                    </div>
                    <div class="row mt-4 d-flex justify-content-between">
                      <div class="col">
                        <h5>Conductor:</h5>
                      </div>
                      <div class="col text-end">
                        <h5>Mario Andreti De Senna</h5>
                      </div>
                    </div>
                    <div class="row mt-2 d-flex justify-content-between">
                      <div class="col">
                        <h5>Vehiculo:</h5>
                      </div>
                      <div class="col text-end">
                        <h5>Nissan Skyline R34 <br> #HBO 1542</h5>
                      </div>
                    </div>
                    <div class="row mt-2 d-flex justify-content-between">
                      <div class="col">
                        <h5>Fecha de salida:</h5>
                      </div>
                      <div class="col text-end">
                        <h5>10/10/2023</h5>
                      </div>
                    </div>
                    <div class="row mt-2 d-flex justify-content-between">
                      <div class="col">
                        <table>
                          <tbody>
                            <tr>
                              <td><h5>Desde:</h5></td>
                              <td><h5>Choloma</h5></td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                      <div class="col d-flex justify-content-end">
                        <table>
                          <tbody>
                            <tr>
                              <td><h5>Hasta:</h5></td>
                              <td><h5>Choloma</h5></td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row card-body">
                  <div class="col">
                    <h5>Pedidos</h5>
                    <ngb-accordion #acc="ngbAccordion">
                      <ngb-panel>
                        <ng-template ngbPanelTitle>
                          <span><h6> Pedido de Margarido clotacio, Destino: lomas </h6></span>
                        </ng-template>
                        <ng-template ngbPanelContent>
                          Anim pariatur cliche reprehenderit, enim eiusmod high life accusamus terry richardson ad squid. 3 wolf
                          moon officia
                          aute, non cupidatat skateboard dolor brunch. Food truck quinoa nesciunt laborum eiusmod. Brunch 3 wolf
                          moon tempor,
                          sunt aliqua put a bird on it squid single-origin coffee nulla assumenda shoreditch et. Nihil anim
                          keffiyeh helvetica,
                          craft beer labore wes anderson cred nesciunt sapiente ea proident. Ad vegan excepteur butcher vice lomo.
                          Leggings
                          occaecat craft beer farm-to-table, raw denim aesthetic synth nesciunt you probably haven't heard of them
                          accusamus
                          labore sustainable VHS.
                        </ng-template>
                      </ngb-panel>
                      <ngb-panel>
                        <ng-template ngbPanelTitle>
                          <span><h6> Pedido de Margarido clotacio, Destino: lomas </h6></span>
                        </ng-template>
                        <ng-template ngbPanelContent>
                          Anim pariatur cliche reprehenderit, enim eiusmod high life accusamus terry richardson ad squid. 3 wolf
                          moon officia
                          aute, non cupidatat skateboard dolor brunch. Food truck quinoa nesciunt laborum eiusmod. Brunch 3 wolf
                          moon tempor,
                          sunt aliqua put a bird on it squid single-origin coffee nulla assumenda shoreditch et. Nihil anim
                          keffiyeh helvetica,
                          craft beer labore wes anderson cred nesciunt sapiente ea proident. Ad vegan excepteur butcher vice lomo.
                          Leggings
                          occaecat craft beer farm-to-table, raw denim aesthetic synth nesciunt you probably haven't heard of them
                          accusamus
                          labore sustainable VHS.
                        </ng-template>
                      </ngb-panel>
                    </ngb-accordion>
                  </div>
                </div>
                <div class="row" hidden>
                  <div class="col">
                    <div class="card">
                      <div class="card-header">
                        <h5>Street View</h5>
                      </div>
                      <div class="card-body">
                        <div class="map-js-height">
                          <div class="my-google-map">
                            <google-map height="500px" width="100%"></google-map>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
                  
                  <button class="btn btn-success pull-right" type="button"
                    >Finish</button>
                  <button class="btn btn-secondary pull-right me-1" id="prevBtn" type="button" awPreviousStep>Anterior</button>
              </aw-wizard-completion-step>
            </aw-wizard>
          </div>
        </div>
        <div class="col-12">
      
    </div>
    </div>
    
  </div>
  

  <ng-template #content1 let-c="close" let-d="dismiss" class="text-center">
    <div class="modal-header d-flex justify-content-center">
      <h4 class="modal-title" id="modal-basic-title">Ups...</h4>
    </div>
    <div class="modal-body text-center">
      <h6>Parece que esta trayectoria aun no ha sido registrada</h6> <br>
      <h6>¿Deseas agregarla?</h6>
    </div>
    <div class="modal-footer d-flex justify-content-center">
      <button type="button" class="btn btn-dark" (click)="nopModal()">No</button>
      <button type="button" class="btn btn-primary" (click)="openModal2(content2)" >Si</button>
    </div>
  </ng-template>

  <ng-template #content2 let-c="close" let-d="dismiss" class="text-center">
    <div class="modal-header d-flex justify-content-center">
      <h4 class="modal-title" id="modal-basic-title">Trayectoria</h4>
    </div>
      <form [formGroup]="trayectoriaFormGroup">
    <div class="modal-body text-center">
        <div class="row mt-2">
          <div class="col">
            <div class="col-form-label">Desde</div>
            <ng-select [readonly]="true" [items]="municipiosDdl" class="" formControlName="muni_Inicio"
            [(ngModel)]="datosTrayecto.muni_Inicio" bindValue="value" groupBy="job" placeholder="Municipio de salida"></ng-select>
            <ng-container class="invalid text-danger"
            *ngIf="trayectoriaFormGroup.get('muni_Inicio').hasError('required') && trayectoriaFormGroup.get('muni_Inicio').touched">
            <p class="text-danger">El municipio de salida es necesario</p></ng-container>
          </div>
          <div class="col">
            <div class="col-form-label">Hasta</div>
            <ng-select [items]="municipiosDdl" class="" formControlName="muni_Final"
           [(ngModel)]="datosTrayecto.muni_Final" bindValue="value" groupBy="job" placeholder="Municipio de destino" [readonly]="true"></ng-select>
            <ng-container class="invalid text-danger"
            *ngIf="trayectoriaFormGroup.get('muni_Final').hasError('required') && trayectoriaFormGroup.get('muni_Final').touched">
            <p class="text-danger">El municipio de destino es necesario</p></ng-container>
          </div>
        </div>
        <div class="row">
          <div class="col-6">
            <label class="form-label">Precio</label>
            <div class="input-group"><input class="form-control" formControlName="tray_Precio" [(ngModel)]="datosTrayecto.tray_Precio" type="number" placeholder="00.00" aria-label="Precio" /><span class="text-dark input-group-text">Lps</span></div>
            <ng-container class="invalid text-danger"
            *ngIf="trayectoriaFormGroup.get('tray_Precio').hasError('required') && trayectoriaFormGroup.get('tray_Precio').touched">
            <p class="text-danger">El precio es necesario</p></ng-container>
          </div>
        </div>
     
    </div>
    <div class="modal-footer d-flex justify-content-center">
      <button type="button" class="btn btn-dark" (click)="nopModal()">Cancelar</button>
      <button type="button" class="btn btn-primary" [disabled]="!trayectoriaFormGroup.valid" (click)="siModal2()"  >Guardar</button>
    </div>
      </form>
  </ng-template>
